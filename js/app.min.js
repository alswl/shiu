(function(){var a={ui:AppUi,book:null,init:function(){var b=this;b.ui.init(b)},isIphone:function(){return(navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))||(navigator.userAgent.match(/iPad/i))},run:function(){var b=this;b.ui.displayHeroUnit();if(!b.isIphone()&&!DEBUG){b.error("请在iPhone/iPod Touch打开")}else{if(window.navigator.standalone||(DEBUG===true&&DEBUG_MODE==="standalone")){if(!b.loadBook()){b.error("书籍数据不存在，开始重新下载");b.downloadCallback=function(){window.location.reload()};b.download()}else{b.info("请单击开始阅读",true);book=b.loadBook();b.book=Book.init(b.loadBook());delete (book);b.ui.displayStandalone();b.bindOrientate()}}else{b.download()}}},downloadCallback:function(){},download:function(){var c=this;c.ui.displayDownload();var b=window.applicationCache;b.ondownloading=function(){window.progresscount=0};b.onprogress=c.ui.onCacheProgress;b.oncached=c.ui.cacheOnCached;b.onnoupdate=c.ui.onCacheNoUpdate;b.onupdateready=c.ui.cacheOnCached;c.loadBookJs()},startRead:function(){var b=this;b.ui.displayRead();b.ui.setChapter(b.book.getCurrentChapter().get$());b.ui.setPage(b.book.getCurrentPage());if(b.book.getCurrentPage()===0){b.book.setPageCount(b.ui.getPageCount())}},loadBookJs:function(){var b=document.createElement("script");b.type="text/javascript";b.src="./book.min.js";$("head")[0].appendChild(b)},saveBook:function(b){db.set(bookTitle+"_book",b)},loadBook:function(){return db.get(bookTitle+"_book")},bindOrientate:function(){var b=this;window.addEventListener("orientationchange",function(c){if(Math.abs(window.orientation)===90){b.error("人家还不会横屏处理啦，等以后的版本吧",true)}else{}},false)},preClick:function(){var b=this;if(b.book.getCurrentPage()>0){b.book.setCurrentPage(b.book.getCurrentPage()-1);b.ui.setPage(b.book.getCurrentPage())}else{if(b.book.getCurrentChapterIndex()>0){b.preChapter()}}},nextClick:function(){var b=this;if(b.book.getCurrentPage()<b.book.getPageCount()-1){b.book.setCurrentPage(b.book.getCurrentPage()+1);b.ui.setPage(b.book.getCurrentPage())}else{if(b.book.getCurrentChapterIndex()<b.book.chapters.length-1){b.nextChapter()}}},preChapter:function(){var b=this;b.book.setCurrentChapterIndex(b.book.getCurrentChapterIndex()-1);b.setChapter()},nextChapter:function(){var b=this;b.book.setCurrentChapterIndex(b.book.getCurrentChapterIndex()+1);b.setChapter()},setChapter:function(){var b=this;b.book.setCurrentPage(0);b.ui.setChapter(b.book.getCurrentChapter().get$());b.book.setPageCount(b.ui.getPageCount());b.ui.setPage(0)},error:function(c,b){this.ui.alert(c,"error",b)},info:function(c,b){this.ui.alert(c,"info",b)},success:function(c,b){this.ui.alert(c,"success",b)},messageDisable:function(){this.ui.alert(null,"disable")}};window.App=a})();