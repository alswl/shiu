(function(){var a={init:function(){var b=this;b.ui=Object.create(window.shiu.ui.AppUi);b.ui.init(b)},run:function(){var b=this;b.ui.displayHeroUnit();if(!window.shiu.util.isIphone()&&!window.shiu.DEBUG){b.error("请在iPhone/iPod Touch打开")}else{if(window.navigator.standalone||(window.shiu.DEBUG===true&&window.shiu.DEBUG_MODE==="standalone")){if(!b.loadBook()){b.error("书籍数据不存在，开始重新下载");b.downloadCallback=function(){window.location.reload()};b.download()}else{b.info("请单击开始阅读",true);book=b.loadBook();b.book=window.shiu.model.Book.init(b.loadBook());delete (book);b.ui.displayStandalone();b.bindOrientate()}}else{b.download()}}},downloadCallback:function(){},download:function(){var c=this;var b=window.applicationCache;c.ui.displayDownload();b.ondownloading=function(){window.progresscount=0};b.onprogress=function(g){var f="";if(g&&g.lengthComputable){f=Math.round(100*g.loaded/g.total)}else{f=Math.round(100*(++progresscount/8))}c.ui.updateDownloadPercent(f)};var d=function(f){c.success("下载完成",true);c.saveBook(window.book);c.ui.updateDownloadComplete();c.downloadCallback()};b.oncached=d;b.onnoupdate=d;b.onupdateready=d;c.loadBookJs()},startRead:function(){var b=this;b.ui.displayRead();b.ui.setChapter(b.book.getCurrentChapter().get$());b.ui.setPage(b.book.getCurrentPage());if(b.book.getCurrentPage()===0){b.book.setPageCount(b.ui.getPageCount())}},loadBookJs:function(){var b=document.createElement("script");b.type="text/javascript";b.src="./book.min.js";$("head")[0].appendChild(b)},saveBook:function(b){db.set(bookTitle+"_book",b)},loadBook:function(){return db.get(bookTitle+"_book")},bindOrientate:function(){var b=this;window.addEventListener("orientationchange",function(c){if(Math.abs(window.orientation)===90){b.error("人家还不会横屏处理啦，等以后的版本吧",true)}else{}},false)},prePage:function(){var b=this;if(b.book.getCurrentPage()>0){b.book.setCurrentPage(b.book.getCurrentPage()-1);b.ui.setPage(b.book.getCurrentPage())}else{if(b.book.getCurrentChapterIndex()>0){b.preChapter()}else{return false}}return true},nextPage:function(){var b=this;if(b.book.getCurrentPage()<b.book.getPageCount()-1){b.book.setCurrentPage(b.book.getCurrentPage()+1);b.ui.setPage(b.book.getCurrentPage())}else{if(b.book.getCurrentChapterIndex()<b.book.chapters.length-1){b.nextChapter()}else{return false}}return true},preChapter:function(){var b=this;b.book.setCurrentChapterIndex(b.book.getCurrentChapterIndex()-1);b.setChapter()},nextChapter:function(){var b=this;b.book.setCurrentChapterIndex(b.book.getCurrentChapterIndex()+1);b.setChapter()},setChapter:function(){var b=this;b.book.setCurrentPage(0);b.ui.setChapter(b.book.getCurrentChapter().get$());b.book.setPageCount(b.ui.getPageCount());b.ui.setPage(0)},error:function(c,b){this.ui.alert(c,"error",b)},info:function(c,b){this.ui.alert(c,"info",b)},success:function(c,b){this.ui.alert(c,"success",b)},messageDisable:function(){this.ui.alert(null,"disable")}};window.shiu.App=a})();