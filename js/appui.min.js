(function(){var a={$heroUnit:$("#hero_unit"),$alert:$("#alert"),$temp:$("#temp"),CHAPTER_SELECTOR:"#content .chapter",$chapter:null,SCREEN_WIDTH:320,SCREEN_HEIGHT:480,SCREEN_PADDING:8,SCREEN_COLUMN_GAP:12,init:function(c){var b=this;b.app=c},displayHeroUnit:function(){this.$heroUnit.show()},displayDownload:function(){this.$heroUnit.find(".book_desc").css("height","120px");$("#download").show()},displayStandalone:function(){var b=this;var c=window.shiu.ui;$("body").bind("touchmove",function(d){d.preventDefault()});b.sidebar=Object.create(c.Sidebar).init("#sidebar",b);b.indexBtn=Object.create(c.IndexBtn).init("#sidebar .index_btn",b);b.content=Object.create(window.shiu.ui.Content).init("#content",b);b.$heroUnit.one("click",function(){b.app.startRead();b.content.bindScroll()})},displayRead:function(){this.$heroUnit.hide();$("#main").show()},setScreen:function(){var b=window.screen.width;var c=window.screen.height;$("#body").css("width",b+"px");$("#main").css("width",b+"px");$("#index").css("width",b+"px");$("#content .chapter").css("width",b+"px");$("#content .chapter").css("-moz-column-width",b+"px");$("#content .chapter").css("-webkit-column-width",b+"px");$("#body").css("height",c+"px");$("#main").css("height",c+"px");$("#index").css("height",c+"px");$("#content").css("height",c+"px");this.SCREEN_WIDTH=b;this.SCREEN_HEIGHT=c;this.setPage(0)},updateDownloadPercent:function(b){$("#download .percent").text(b)},updateDownloadComplete:function(){this.updateDownloadPercent(100);$("#download .tip").text("下载完成");$("#download .complete").show()},alert:function(d,e,c){var b=this;if(e==="disable"){b.$alert.hide();b.$alert.children().html("").removeClass();return}b.$alert.show();b.$alert.children().html(d).addClass(e);if(c===undefined){$("body").one("click",function(){b.$alert.hide();b.$alert.children().html("").removeClass()})}else{setTimeout(function(){b.$alert.hide();b.$alert.children().html("").removeClass()},3000)}},setChapter:function(b){this.content.setChapter(b)},setPage:function(b){this.content.setPage(b)},getPageCount:function(){return this.content.getPageCount()}};window.shiu.ui.AppUi=a})();(function(){var a={init:function(b,d){var c=this;c.$=$(b);c.ui=d;c.$indexs=$("#indexs");c.initIndexs();c.bindTouchStart();c.bindAClick();return c},initIndexs:function(){var b=this;b.ui.$temp.html(b.ui.app.book.getIndexsHtml());b.$indexs.append(b.ui.$temp.children())},bindIndexsScroll:function(){this.iScroll=new iScroll("index_wrapper",{})},fadeX:function(b){this.$.css("-webkit-transform","translate3d("+b+"px, 0, 0)");this.$.css("-moz-transform","translate3d("+b+"px, 0, 0)")},hide:function(){this.fadeX(0);this.$.css("background","none")},show:function(){if(this.iScroll===undefined){this.bindIndexsScroll()}this.fadeX(320);this.$.css("background","transparent")},isVisiable:function(){return this.$.offset().left>=0},toggle:function(){if(this.isVisiable()){this.hide()}else{this.show()}},bindTouchStart:function(){var b=this;b.$.bind("touchstart",function(c){if(c.touches[0].clientX-b.$.offset().left>280){b.hide();return false}})},bindAClick:function(){var b=this;b.$.find("#indexs li a").click(function(c){b.ui.app.book.setCurrentChapterIndex(parseInt(this.rel,10));b.ui.app.setChapter();b.hide()})},};window.shiu.ui.Sidebar=a})();(function(){var a={init:function(b,d){var c=this;c.$=$(b);c.ui=d;c.bindTouchStart();return c},hide:function(){this.ui.sidebar.hide()},show:function(){this.ui.sidebar.fadeX(40)},isVisiable:function(){return this.ui.sidebar.$.offset().left>=-280},toggle:function(){if(this.isVisiable()){this.hide()}else{this.show()}},bindTouchStart:function(){var b=this;b.$.bind("touchstart",function(c){b.ui.sidebar.toggle();c.stopPropagation();return false})},bindDragEnd:function(){var b=this;b.$.ondragend=function(c){b.ui.sidebar.show()}},};window.shiu.ui.IndexBtn=a})();(function(){var a={CHAPTER_SELECTOR:"#content .chapter",init:function(b,d){var c=this;c.$=$(b);c.$chapter=$(b).find(".chapter");c.ui=d;c.isTouchEvent=false;c.isTouchLock=false;c.bindClick();return c},bindClick:function(){var b=this;b.$.click(function(d){var c=d.clientX;var f=d.clientY;if(!b.isTouchEvent){if(c<100){b.ui.app.prePage();b.ui.indexBtn.hide()}else{if(c>220){b.ui.app.nextPage();b.ui.indexBtn.hide()}else{b.ui.indexBtn.toggle()}}}})},bindScroll:function(){var b=this;b.$.bind("touchstart",function(c){b.startX=c.touches[0].pageX;b.startLeft=b.$chapter.offset().left});b.$.bind("touchmove",function(c){if(b.isTouchLock){return false}b.isTouchLock=true;if(c.touches.length>1){return false}b.transformX(b.startLeft-b.startX+c.touches[0].pageX);b.isTouchLock=false});b.$.bind("touchend",function(c){var d=c.changedTouches[0].pageX-b.startX;b.isTouchEvent=true;if(d<0&&Math.abs(d)>=60){if(!b.ui.app.nextPage()){b.transformX(b.startLeft)}}else{if(d>0&&Math.abs(d)>=60){if(!b.ui.app.prePage()){b.transformX(b.startLeft)}}else{if(Math.abs(d)<10){b.isTouchEvent=false}b.transformX(b.startLeft)}}});b.$.bind("touchcancel",function(c){b.transformX(b.startLeft);return false})},transformX:function(b){this.$chapter.css("-webkit-transform","translate3d("+b+"px, 0, 0)");this.$chapter.css("-moz-transform","translate3d("+b+"px, 0, 0)")},setChapter:function(c){var b=this;b.ui.app.info("载入中…",true);b.ui.$temp.html(c);b.$.children().remove();b.$.append(b.ui.$temp.children());b.$chapter=$(b.CHAPTER_SELECTOR)},setPage:function(c){var b=this;var d=0-c*(b.ui.SCREEN_WIDTH+b.ui.SCREEN_COLUMN_GAP);b.transformX(d)},getPageCount:function(){return(this.$chapter.children().last().offset().left-this.ui.SCREEN_PADDING)/(this.ui.SCREEN_WIDTH+this.ui.SCREEN_COLUMN_GAP)+1}};window.shiu.ui.Content=a})();