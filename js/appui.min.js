(function(){var a={$heroUnit:$("#hero_unit"),$content:$("#content"),$alert:$("#alert"),$temp:$("#temp"),$sidebar:$("#sidebar"),$indexs:$("#indexs"),$indexBtn:$("#sidebar .index_btn"),CHAPTER_SELECTOR:"#content .chapter",$chapter:null,SCREEN_WIDTH:320,SCREEN_HEIGHT:480,SCREEN_PADDING:8,SCREEN_COLUMN_GAP:12,init:function(c){var b=this;b.app=c},displayHeroUnit:function(){$("#hero_unit").show()},displayDownload:function(){$("#hero_unit .book_desc").css("height","120px");$("#download").show()},displayStandalone:function(){var b=this;$("body").bind("touchmove",function(c){c.preventDefault()});b.$heroUnit.one("click",function(){b.app.startRead();b.initIndexs();b.bindChapterClick();b.bindIndexBtnClick();b.bindSidebarClick();b.bindIndexAClick()})},displayRead:function(){this.$heroUnit.hide();$("#main").show()},initIndexs:function(){var b=this;b.$indexs.html(b.app.book.getIndexsHtml());b.bindIndexsScroll()},setScreen:function(){var b=window.screen.width;var c=window.screen.height;$("#body").css("width",b+"px");$("#main").css("width",b+"px");$("#index").css("width",b+"px");$("#content .chapter").css("width",b+"px");$("#content .chapter").css("-moz-column-width",b+"px");$("#content .chapter").css("-webkit-column-width",b+"px");$("#body").css("height",c+"px");$("#main").css("height",c+"px");$("#index").css("height",c+"px");$("#content").css("height",c+"px");this.SCREEN_WIDTH=b;this.SCREEN_HEIGHT=c;this.setPage(0)},onCacheProgress:function(d){var b=this;var c="";if(d&&d.lengthComputable){c=Math.round(100*d.loaded/d.total)}else{c=Math.round(100*(++progresscount/8))}$("#download .percent").text(c)},cacheOnCached:function(b){App.success("下载完成",true);App.saveBook(window.book);$("#download .percent").text("100");$("#download .tip").text("下载完成");$("#download .complete").show();App.downloadCallback()},onCacheNoUpdate:function(){App.success("下载完成",true);App.saveBook(window.book);$("#download .percent").text("100");$("#download .tip").text("下载完成");$("#download .complete").show();App.downloadCallback()},alert:function(d,e,c){var b=this;if(e==="disable"){b.$alert.hide();b.$alert.children().html("").removeClass();return}b.$alert.show();b.$alert.children().html(d).addClass(e);if(c===undefined){$("body").one("click",function(){b.$alert.hide();b.$alert.children().html("").removeClass()})}else{setTimeout(function(){App.ui.$alert.hide();App.ui.$alert.children().html("").removeClass()},3000)}},bindChapterClick:function(){var b=this;b.$content.click(function(d){var c=d.clientX;var f=d.clientY;if(c<100){b.app.preClick();b.$indexBtn._hide()}else{if(c>220){b.app.nextClick();b.$indexBtn._hide()}else{b.$indexBtn._toggle()}}})},bindIndexBtnClick:function(){var b=this;b.$indexBtn._hide=function(){b.$sidebar.css("-webkit-transform","translate3d(0, 0, 0)");b.$sidebar.css("-moz-transform","translate3d(0, 0, 0)")};b.$indexBtn._show=function(){b.$sidebar.css("-webkit-transform","translate3d(40px, 0, 0)");b.$sidebar.css("-moz-transform","translate3d(40px, 0, 0)")};b.$indexBtn._toggle=function(){if(b.$indexBtn.offset().left<0){b.$indexBtn._show()}else{b.$indexBtn._hide()}};b.$indexBtn.click(function(c){b.$sidebar._toggle();c.stopPropagation()})},bindIndexAClick:function(){var b=this;b.$indexs.find("li a").click(function(c){b.app.book.setCurrentChapterIndex(parseInt(this.rel,10));b.app.setChapter();return false})},bindSidebarClick:function(){var b=this;b.$sidebar._hide=function(){b.$sidebar.css("-webkit-transform","translate3d(0, 0, 0)");b.$sidebar.css("-moz-transform","translate3d(0, 0, 0)");b.$sidebar.css("background","none")};b.$sidebar._show=function(){b.$sidebar.css("-webkit-transform","translate3d(320px, 0, 0)");b.$sidebar.css("-moz-transform","translate3d(320px, 0, 0)");b.$sidebar.css("background","transparent")};b.$sidebar._toggle=function(){if(b.$sidebar.offset().left<0){b.$sidebar._show()}else{b.$sidebar._hide()}};b.$sidebar.click(function(c){if(c.clientX>280){if(b.$sidebar.offset().left<0){}else{b.$sidebar._hide()}}b.$indexBtn._hide()})},bindIndexsScroll:function(){new iScroll("index_wrapper",{})},setPage:function(c){var b=this;var d=0-c*(b.SCREEN_WIDTH+b.SCREEN_COLUMN_GAP);if($.browser.webkit){}b.$chapter.css("-webkit-transform","translate3d("+d+"px, 0, 0)");b.$chapter.css("-moz-transform","translate3d("+d+"px, 0, 0)")},setChapter:function(b){this.$temp.html(b);this.$content.children().remove();this.$content.append(this.$temp.children());this.$chapter=$(this.CHAPTER_SELECTOR)},getPageCount:function(){return($(".chapter *").last().offset().left-this.SCREEN_PADDING)/(this.SCREEN_WIDTH+this.SCREEN_COLUMN_GAP)+1}};window.AppUi=a})();