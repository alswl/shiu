(function(){var a={$heroUnit:$("#hero_unit"),$alert:$("#alert"),$temp:$("#temp"),CHAPTER_SELECTOR:"#content .chapter",$chapter:null,SCREEN_WIDTH:320,SCREEN_HEIGHT:480,SCREEN_PADDING:8,SCREEN_BOTTOM_HEIGHT:10,SCREEN_COLUMN_GAP:12,init:function(c){var b=this;b.app=c;b.setScreen()},displayHeroUnit:function(){this.$heroUnit.show()},displayDownload:function(){this.$heroUnit.find(".book_desc").css("height","120px");$("#download").show()},displayStandalone:function(){var b=this,c=window.shiu.ui;$("body").bind("touchmove",function(d){d.preventDefault()});b.sidebar=Object.create(c.Sidebar).init("#sidebar",b);b.buttons=Object.create(c.Buttons).init("#sidebar .buttons",b);b.content=Object.create(window.shiu.ui.Content).init("#content",b);b.$heroUnit.one("click",function(){b.app.startRead();b.content.bindScroll()})},displayRead:function(){this.$heroUnit.hide();$("#main").show()},setScreen:function(c){c=c||false;var b=window.screen.width,d=document.body.scrollHeight;if(c){this.SCREEN_WIDTH=d;this.SCREEN_HEIGHT=b}else{this.SCREEN_WIDTH=b;this.SCREEN_HEIGHT=d}},updateDownloadPercent:function(b){$("#download .percent").text(b)},updateDownloadComplete:function(){this.updateDownloadPercent(100);$("#download .tip").text("下载完成");$("#download .complete").show()},alert:function(d,e,c){var b=this;if(e==="disable"){b.$alert.hide();b.$alert.children().html("").removeClass();return}b.$alert.show();b.$alert.children().html(d).addClass(e);if(c===undefined){$("body").one("click",function(){b.$alert.hide();b.$alert.children().html("").removeClass()})}else{setTimeout(function(){b.$alert.hide();b.$alert.children().html("").removeClass()},3000)}},setChapter:function(b){this.content.setChapter(b)},setPage:function(b){this.content.setPage(b)},getPageCount:function(){return this.content.getPageCount()}};window.shiu.ui.AppUi=a}());(function(){var a={init:function(b,d){var c=this;c.$=$(b);c.ui=d;c.$indexs=$("#indexs");c.initIndexs();c.bindTouchStart();c.bindAClick();$("#index_wrapper").css("height",(c.ui.SCREEN_HEIGHT)+"px");return c},initIndexs:function(){var b=this;b.ui.$temp.html(b.ui.app.book.getIndexsHtml());b.$indexs.append(b.ui.$temp.children())},bindIndexsScroll:function(){this.iScroll=new iScroll("index_wrapper",{})},fadeX:function(b){this.$.css("-webkit-transform","translate3d("+b+"px, 0, 0)");this.$.css("-moz-transform","translate3d("+b+"px, 0, 0)")},hide:function(){this.fadeX(0);this.$.css("background","none")},show:function(){if(this.iScroll===undefined){this.bindIndexsScroll()}this.fadeX(320);this.$.css("background","transparent")},isVisiable:function(){return this.$.offset().left>=0},toggle:function(){if(this.isVisiable()){this.hide()}else{this.show()}},bindTouchStart:function(){var b=this;b.$.bind("touchstart",function(c){if(c.touches[0].clientX-b.$.offset().left>280){b.hide();return false}})},bindAClick:function(){var b=this;b.$.find("#indexs li a").click(function(c){b.ui.app.book.setCurrentChapterIndex(parseInt(this.rel,10));b.ui.app.setChapter();b.hide()})}};window.shiu.ui.Sidebar=a}());(function(){var a={init:function(b,d){var c=this;c.$=$(b);c.$index=$(b).children(".index_btn");c.$fontZi=$(b).children(".font_zi_btn");c.$fontZo=$(b).children(".font_zo_btn");c.ui=d;c.bindTouchStart();return c},hide:function(){this.ui.sidebar.hide()},show:function(){this.ui.sidebar.fadeX(40)},isVisiable:function(){return this.ui.sidebar.$.offset().left>=-280},toggle:function(){if(this.isVisiable()){this.hide()}else{this.show()}},bindTouchStart:function(){var b=this;b.$index.bind("touchstart",function(c){b.ui.sidebar.toggle();c.stopPropagation();return false});b.$fontZi.bind("touchstart",function(c){b.ui.content.incFontSize();c.stopPropagation();return false});b.$fontZo.bind("touchstart",function(c){b.ui.content.decFontSize();c.stopPropagation();return false})},bindDragEnd:function(){var b=this;b.$index.ondragend=function(c){b.ui.sidebar.show()}}};window.shiu.ui.Buttons=a}());(function(){var a={CHAPTER_SELECTOR:"#content .chapter",init:function(b,d){var c=this;c.ui=d;c.$=$(b);c.$chapter=$(b).find(".chapter");c.isTouchEvent=false;c.isTouchLock=false;c.$.css("height",c.ui.SCREEN_HEIGHT+"px");c.bindClick();return c},bindClick:function(){var b=this;b.$.click(function(d){var c=d.clientX,f=d.clientY;if(!b.isTouchEvent){if(c<b.ui.SCREEN_WIDTH*0.25){b.ui.app.prePage();b.ui.buttons.hide()}else{if(c>b.ui.SCREEN_WIDTH*0.75){b.ui.app.nextPage();b.ui.buttons.hide()}else{b.ui.buttons.toggle()}}}})},bindScroll:function(){var b=this;b.$.bind("touchstart",function(c){b.startX=c.touches[0].pageX;b.startLeft=b.$chapter.offset().left});b.$.bind("touchmove",function(c){if(b.isTouchLock){return false}b.isTouchLock=true;if(c.touches.length>1){return false}b.transformX(b.startLeft-b.startX+c.touches[0].pageX);b.isTouchLock=false});b.$.bind("touchend",function(c){var d=c.changedTouches[0].pageX-b.startX;b.isTouchEvent=true;if(d<0&&Math.abs(d)>=60){if(!b.ui.app.nextPage()){b.transformX(b.startLeft)}}else{if(d>0&&Math.abs(d)>=60){if(!b.ui.app.prePage()){b.transformX(b.startLeft)}}else{if(Math.abs(d)<10){b.isTouchEvent=false}b.transformX(b.startLeft)}}});b.$.bind("touchcancel",function(c){b.transformX(b.startLeft);return false})},transformX:function(b){this.$chapter.css("-webkit-transform","translate3d("+b+"px, 0, 0)");this.$chapter.css("-moz-transform","translate3d("+b+"px, 0, 0)")},setChapter:function(c){var b=this;b.ui.app.info("载入中…",true);b.ui.$temp.html(c);b.$.children().remove();b.$.append(b.ui.$temp.children());b.$chapter=$(b.CHAPTER_SELECTOR);b.$chapter.css("height",(b.ui.SCREEN_HEIGHT-b.ui.SCREEN_BOTTOM_HEIGHT)+"px");b.$chapter.css("-webkit-column-width",b.ui.SCREEN_WIDTH+"px");b.$chapter.children("p").css("font-size",b.ui.app.book.getFontSize())},setPage:function(c){var b=this,d=-(c*(b.ui.SCREEN_WIDTH+b.ui.SCREEN_COLUMN_GAP));b.transformX(d)},getPageCount:function(){return((this.$chapter.find(".end").offset().left-this.$chapter.children().first().offset().left))/(this.ui.SCREEN_WIDTH+this.ui.SCREEN_COLUMN_GAP)+1},incFontSize:function(){var b=this,c=parseInt(b.$chapter.children("p").css("font-size"),10);if(c<32){b.$chapter.children("p").css("font-size",(c+2)+"px")}b.ui.app.book.setPageCount(b.getPageCount());b.ui.app.book.setFontSize(c)},decFontSize:function(){var b=this,c=parseInt(b.$chapter.children("p").css("font-size"),10);if(c>12){b.$chapter.children("p").css("font-size",(c-2)+"px")}b.ui.app.book.setPageCount(b.getPageCount());b.ui.app.book.setFontSize(c);if(b.ui.app.book.getPageCount()<=b.ui.app.book.getCurrentPage()){b.ui.app.prePage()}}};window.shiu.ui.Content=a}());